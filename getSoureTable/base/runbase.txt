#!/bin/bash

# 3. 赋予Python脚本执行权限
chmod +x /www/wwwroot/getSoureTable/getSourceData.py

# 4. 创建日志文件（如果不存在）
touch /www/wwwroot/getSoureTable/log.txt
chmod 644 /www/wwwroot/getSoureTable/log.txt

# 5. 设置Cron任务：使用crontab命令添加每10分钟执行一次的定时任务
(crontab -l 2>/dev/null; echo "*/10 * * * * /www/wwwroot/getSoureTable/myenv/bin/python3 /www/wwwroot/getSoureTable/getSourceData.py >> /www/wwwroot/getSoureTable/log.txt 2>&1") | crontab -

# 6. 验证任务：通过crontab -l查看任务是否成功添加
echo "Cron任务已设置，每10分钟运行一次 /www/wwwroot/getSoureTable/getSourceData.py"
echo "日志文件: /www/wwwroot/getSoureTable/log.txt"

# 7. 确保当前脚本也有执行权限
chmod +x setup_cron_job.sh

# 8. 手动测试脚本
/www/wwwroot/getSoureTable/myenv/bin/python3 /www/wwwroot/getSoureTable/getSourceData.py >> /www/wwwroot/getSoureTable/log.txt 2>&1
echo "手动测试脚本已完成，查看日志文件确认输出。"

# 9. 再次验证任务
crontab -l
