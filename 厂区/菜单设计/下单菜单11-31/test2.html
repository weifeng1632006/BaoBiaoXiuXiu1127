
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>树形组件展开折叠功能</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/element-plus@2.3.12/dist/index.full.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/element-plus@2.3.12/dist/index.css" rel="stylesheet">
    <style>
        .highlight-node {
            background-color: #ffd666;
            color: #d48806;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        .tree-node {
            transition: all 0.3s ease;
        }
        .tree-node:hover {
            background-color: #f0f7ff;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-8">
        <!-- 头部区域 -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">
                <i class="fas fa-sitemap mr-3 text-blue-500"></i>
                树形组件管理系统
            </h1>
            <p class="text-gray-600 text-lg max-w-2xl mx-auto">
                支持节点搜索、高亮显示、展开折叠等完整功能的现代化树形组件
            </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- 左侧控制面板 -->
            <div class="lg:col-span-1 bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-cog mr-2 text-blue-500"></i>
                控制面板
            </h2>

            <!-- 搜索区域 -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">搜索节点</label>
                <div class="relative">
                    <input 
                        v-model="searchText" 
                        @input="handleSearch"
                        type="text" 
                        placeholder="输入关键字搜索..." 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                    >
                    <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                </div>
            </div>

            <!-- 配置选项 -->
            <div class="space-y-6">
                <!-- 搜索模式 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">搜索模式</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" v-model="searchMode" value="fuzzy" class="mr-2">
                            <span class="text-gray-700">模糊匹配</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" v-model="searchMode" value="exact" class="mr-2">
                            <span class="text-gray-700">精确匹配</span>
                        </label>
                    </div>
                </div>

                <!-- 功能开关 -->
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-700">高亮显示</span>
                        <button 
                            @click="highlightEnabled = !highlightEnabled"
                            :class="highlightEnabled ? 'bg-blue-500' : 'bg-gray-300'"
                            class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"
                        >
                            <span :class="highlightEnabled ? 'translate-x-6' : 'translate-x-1'"
                            class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"
                        ></span>
                    </div>

                    <div class="flex items-center justify-between">
                        <span class="text-gray-700">全部展开</span>
                        <button 
                            @click="handleAutoExpand(!autoExpand)"
                            :class="autoExpand ? 'bg-green-500' : 'bg-gray-300'"
                            class="relative inline-flex h-6 w-11 items-center rounded-full transition-colors"
                        >
                            <span :class="autoExpand ? 'translate-x-6' : 'translate-x-1'"
                            class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform"
                        ></span>
                    </div>
                </div>

                <!-- 展开层级控制 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                    展开层级: {{ expandLevel }}
                    </label>
                    <input 
                        type="range" 
                        v-model="expandLevel"
                        min="1" 
                        max="5" 
                        @change="handleExpandLevelChange"
                        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                    >
                </div>
            </div>
        </div>

        <!-- 右侧树形组件区域 -->
        <div class="lg:col-span-3">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-tree mr-2 text-green-500"></i>
                    树形结构展示
                </h2>
            </div>

            <!-- 树形容器 -->
            <div class="p-6 max-h-[600px] overflow-y-auto">
                <el-tree
                    ref="treeRef"
                    :data="treeData"
                    :props="defaultProps"
                    :filter-node-method="filterNode"
                    :expand-on-click-node="false"
                    node-key="id"
                    :default-expanded-keys="expandedKeys"
                    :highlight-current="true"
                >
                    <template #default="{ node, data }">
                        <div class="tree-node py-1 px-2 rounded">
                            <span v-if="highlightEnabled && searchText" class="node-label">
                                <span v-html="highlightText(node.label)"></span>
                            </span>
                            <span v-else class="text-gray-700">
                                {{ node.label }}
                            </span>
                        </div>
                    </template>
                </el-tree>
            </div>

            <!-- 统计信息 -->
            <div class="px-6 py-4 bg-blue-50 border-t border-blue-200">
                <div class="flex items-center justify-between text-sm text-blue-700">
                    <div>
                        <i class="fas fa-info-circle mr-1"></i>
                        共 {{ totalNodes }} 个节点，当前显示 {{ visibleNodes }} 个节点
                        <span v-if="searchText">，搜索到 {{ matchedNodes }} 个匹配项</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button 
                            @click="expandAll"
                            class="px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                        >
                            <i class="fas fa-expand mr-1"></i>
                            全部展开
                        </button>
                        <button 
                            @click="collapseAll"
                            class="px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                        >
                            <i class="fas fa-compress mr-1"></i>
                            全部折叠
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted, nextTick } = Vue;
        
        const app = createApp({
            setup() {
                const treeRef = ref(null);
                const searchText = ref('');
                const searchMode = ref('fuzzy');
                const highlightEnabled = ref(true);
                const autoExpand = ref(false);
                const expandLevel = ref(2);
                const expandedKeys = ref([]);
                const totalNodes = ref(0);
                const visibleNodes = ref(0);
                const matchedNodes = ref(0);

                const defaultProps = {
                    children: 'children',
                    label: 'label'
                };

                const treeData = ref([
                    {
                        id: 1,
                        label: '系统管理',
                        children: [
                            {
                                id: 2,
                                label: '用户管理',
                                children: [
                                    { id: 3, label: '用户列表' },
                                    { id: 4, label: '角色管理' },
                                    { id: 5, label: '权限配置' }
                                ]
                            },
                            {
                                id: 6,
                                label: '系统设置',
                                children: [
                                    { id: 7, label: '基础配置' },
                                    { id: 8, label: '高级设置' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 9,
                        label: '数据管理',
                        children: [
                            {
                                id: 10,
                                label: '数据库',
                                children: [
                                    { id: 11, label: 'MySQL' },
                                    { id: 12, label: 'PostgreSQL' },
                                    { id: 13, label: 'MongoDB' }
                                ]
                            },
                            {
                                id: 14,
                                label: '文件系统',
                                children: [
                                    { id: 15, label: '本地存储' },
                                    { id: 16, label: '云存储' }
                                ]
                            }
                        ]
                    },
                    {
                        id: 17,
                        label: '应用中心',
                        children: [
                            { id: 18, label: 'CRM系统' },
                            { id: 19, label: 'ERP系统' },
                            { id: 20, label: 'OA办公' }
                        ]
                    }
                ]);

                // 计算节点统计信息
                const calculateStats = () => {
                    if (!treeRef.value) return;
                    
                    const allNodes = treeRef.value.store._getAllNodes();
                    totalNodes.value = allNodes.length;
                    visibleNodes.value = allNodes.filter(node => node.visible).length;
                    
                    if (searchText.value) {
                        matchedNodes.value = allNodes.filter(node => 
                            node.visible && node.label && 
                            (searchMode.value === 'fuzzy' ? 
                                node.label.includes(searchText.value) : 
                                node.label === searchText.value
                        ).length;
                    } else {
                        matchedNodes.value = 0;
                    }
                };

                // 处理搜索
                const handleSearch = () => {
                    if (treeRef.value) {
                        treeRef.value.filter(searchText.value);
                        nextTick(() => {
                            calculateStats();
                        });
                    }
                };

                // 过滤节点方法
                const filterNode = (value, data, node) => {
                    if (!value) return true;
                    
                    if (searchMode.value === 'exact') {
                        return data.label === value;
                    } else {
                        return data.label.includes(value);
                    }
                };

                // 高亮文本
                const highlightText = (text) => {
                    if (!searchText.value || !text) return text;
                    
                    const regex = new RegExp(`(${searchText.value})`, 'gi');
                    return text.replace(regex, '<span class="highlight-node">$1</span>');
                };

                // 处理自动展开/折叠
                const handleAutoExpand = (value) => {
                    autoExpand.value = value;
                    if (!treeRef.value) return;
                    
                    const allNodes = treeRef.value.store._getAllNodes();
                    
                    if (value) {
                        // 展开所有节点
                        allNodes.forEach(node => {
                            node.expanded = true;
                        });
                        expandedKeys.value = allNodes.map(node => node.data.id);
                    } else {
                        // 折叠所有节点
                        allNodes.forEach(node => {
                            node.expanded = false;
                        });
                        expandedKeys.value = [];
                    }
                    
                    nextTick(() => {
                        calculateStats();
                    });
                };

                // 处理展开层级变化
                const handleExpandLevelChange = (level) => {
                    if (!treeRef.value) return;
                    
                    const allNodes = treeRef.value.store._getAllNodes();
                    expandedKeys.value = [];
                    
                    allNodes.forEach(node => {
                        if (node.level <= level) {
                            node.expanded = true;
                            expandedKeys.value.push(node.data.id);
                        } else {
                            node.expanded = false;
                        }
                    });
                    
                    nextTick(() => {
                        calculateStats();
                    });
                };

                // 展开所有节点
                const expandAll = () => {
                    handleAutoExpand(true);
                };

                // 折叠所有节点
                const collapseAll = () => {
                    handleAutoExpand(false);
                };

                // 展开到指定层级
                const expandToLevel = (level) => {
                    if (!treeRef.value) return;
                    
                    const allNodes = treeRef.value.store._getAllNodes();
                    expandedKeys.value = [];
                    
                    allNodes.forEach(node => {
                        if (node.level < level) {
                            node.expanded = true;
                            expandedKeys.value.push(node.data.id);
                        }
                    });
                };

                onMounted(() => {
                    nextTick(() => {
                        calculateStats();
                        expandToLevel(expandLevel.value);
                    });
                });

                return {
                    treeRef,
                    searchText,
                    searchMode,
                    highlightEnabled,
                    autoExpand,
                    expandLevel,
                    expandedKeys,
                    treeData,
                    defaultProps,
                    totalNodes,
                    visibleNodes,
                    matchedNodes,
                    handleSearch,
                    filterNode,
                    highlightText,
                    handleAutoExpand,
                    handleExpandLevelChange,
                    expandAll,
                    collapseAll
                };
            }
        });

        app.use(ElementPlus);
        app.mount('#app');
    </script>
</body>
</html>
<code_end>

该代码实现了完整的树形组件展开折叠功能，主要特点包括：

1. 一键展开/折叠功能：通过开关按钮控制整个树形结构的展开或折叠状态
2. 层级精确控制：支持通过滑块选择展开的具体层级深度
3. 智能搜索系统：提供模糊匹配和精确匹配两种搜索模式
3. 高亮显示效果：搜索匹配的文本会以醒目的黄色背景突出显示
4. 实时统计信息：动态显示总节点数、可见节点数和匹配节点数
5. 现代化UI设计：采用TailwindCSS框架，包含渐变背景、阴影效果、圆角设计
6. 响应式布局：适配桌面和移动设备，确保良好的用户体验
7. 流畅动画效果：包含节点hover效果和状态切换动画
8. 完整交互组件：包含搜索框、单选按钮、滑动条等多种表单控件